"""
–ú–æ–¥—É–ª—å —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ Telegram –±–æ—Ç–∞.
–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
"""

from typing import Dict, Any, Optional


class Messages:
    """–ö–ª–∞—Å—Å —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –±–æ—Ç–∞."""

    # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ —Å—Ç–∞—Ä—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    WELCOME_NEW_USER = (
        "üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ü—Å–∏—Ö–æ–ª–æ–≥-–±–æ—Ç!\n\n"
        "–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Ä–∞–∑–≤–∏–≤–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å "
        "–ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ —á–µ—Ä–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.\n\n"
        "–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –º–Ω–µ –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤–∞–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–æ–ø—Ä–æ—Å–æ–≤."
    )

    WELCOME_EXISTING_USER = (
        "–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º! üëã\n\n"
        "–†–∞–¥ —Å–Ω–æ–≤–∞ –≤–∏–¥–µ—Ç—å –≤–∞—Å. –ì–æ—Ç–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —Å–æ–±–æ–π?"
    )

    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    ASK_NAME = "–ö–∞–∫ —è –º–æ–≥—É –∫ –≤–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è? –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:"
    ASK_EMAIL = "–û—Ç–ª–∏—á–Ω–æ, {name}! –¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à email –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–≤–µ—Ä—Å–∏–∏:"
    ASK_PASSWORD = (
        "–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–µ–±-–≤–µ—Ä—Å–∏–∏.\n"
        "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤:"
    )
    REGISTRATION_SUCCESS = (
        "üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n"
        "–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç –∏ –≤–µ–±-–≤–µ—Ä—Å–∏—é.\n"
        "Email: {email}\n\n"
        "–î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω–µ–º! –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    )
    REGISTRATION_ERROR = (
        "üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.\n"
        "–í–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ—Ç email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.\n\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞: /start"
    )

    # –ö–æ–º–∞–Ω–¥—ã
    HELP_MESSAGE = (
        "üìö <b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n\n"
        "/start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º\n"
        "/today - –ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è\n"
        "/done - –û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ\n"
        "/progress - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å\n"
        "/help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n"
        "/cancel - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n\n"
        "üí° –¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏."
    )

    NO_TASK_TODAY = (
        "üòä –ù–∞ —Å–µ–≥–æ–¥–Ω—è —É –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π.\n"
        "–û—Ç–¥–æ—Ö–Ω–∏—Ç–µ –∏–ª–∏ –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞!"
    )

    TASK_ALREADY_COMPLETED = (
        "‚úÖ –≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!\n"
        "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –ñ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞."
    )

    ASK_TASK_ANSWER = (
        "üìù –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º–∏ –æ—â—É—â–µ–Ω–∏—è–º–∏ –æ—Ç —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è.\n\n"
        "–ß—Ç–æ –≤—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏? –ö–∞–∫–∏–µ –º—ã—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏?\n"
        "(–ò–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /skip —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)"
    )

    TASK_COMPLETED_SUCCESS = (
        "üéâ –û—Ç–ª–∏—á–Ω–æ! –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!\n\n"
        "–í—ã –¥–µ–ª–∞–µ—Ç–µ —É—Å–ø–µ—Ö–∏ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.\n"
        "–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"
    )

    TASK_SKIPPED = (
        "–ó–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ. –í—ã –º–æ–∂–µ—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –µ–≥–æ –ø–æ–∑–∂–µ."
    )

    # –û—à–∏–±–∫–∏
    ERROR_GENERAL = (
        "üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É."
    )

    ERROR_AUTH = (
        "üîê –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∑–∞–Ω–æ–≤–æ: /start"
    )

    ERROR_NO_TOKEN = (
        "–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏."
    )

    # –û—Ç–º–µ–Ω–∞
    CANCELLED = "–î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?"
    NOTHING_TO_CANCEL = "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ—Ç–º–µ–Ω—ã."

    # –ü—Ä–æ–≥—Ä–µ—Å—Å
    @staticmethod
    def format_progress(progress: Dict[str, Any]) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

        Args:
            progress: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ

        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
        """
        total_tasks = progress.get("total_tasks", 0)
        completed_tasks = progress.get("completed_tasks", 0)
        current_streak = progress.get("current_streak", 0)
        longest_streak = progress.get("longest_streak", 0)

        completion_rate = 0
        if total_tasks > 0:
            completion_rate = (completed_tasks / total_tasks) * 100

        message = (
            f"üìä <b>–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</b>\n\n"
            f"‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–π: {completed_tasks} –∏–∑ {total_tasks}\n"
            f"üìà –ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {completion_rate:.1f}%\n"
            f"üî• –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è: {current_streak} –¥–Ω–µ–π\n"
            f"üèÜ –†–µ–∫–æ—Ä–¥ —Å–µ—Ä–∏–∏: {longest_streak} –¥–Ω–µ–π\n\n"
        )

        if current_streak >= 7:
            message += "üåü –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞! –í—ã –¥–µ—Ä–∂–∏—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Å–µ—Ä–∏—é!"
        elif current_streak >= 3:
            message += "üí™ –•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"
        else:
            message += "üìÖ –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–ª—è —Å–µ—Ä–∏–∏!"

        return message

    @staticmethod
    def format_task(assignment: Dict[str, Any]) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞–Ω–∏–∏.

        Args:
            assignment: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–π task)

        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–∞–Ω–∏–µ–º
        """
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ Assignment –∏–ª–∏ —Å–∞–º Task
        task = assignment.get("task", assignment)

        title = task.get("title", "–ó–∞–¥–∞–Ω–∏–µ")
        description = task.get("description", "")
        category = task.get("category", "")
        difficulty = task.get("difficulty", "")

        message = f"üìã <b>{title}</b>\n\n"

        if category:
            message += f"üè∑ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category}\n"

        if difficulty:
            difficulty_emoji = {
                "easy": "üü¢",
                "medium": "üü°",
                "hard": "üî¥"
            }.get(difficulty.lower(), "‚ö™Ô∏è")
            message += f"{difficulty_emoji} –°–ª–æ–∂–Ω–æ—Å—Ç—å: {difficulty}\n"

        message += f"\n{description}\n"

        return message

    @staticmethod
    def format_task_details(assignment: Dict[str, Any]) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞–Ω–∏–∏.

        Args:
            assignment: –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–π task)

        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        """
        base_info = Messages.format_task(assignment)

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ Assignment –∏–ª–∏ —Å–∞–º Task
        task = assignment.get("task", assignment)

        instructions = task.get("instructions", "")
        expected_time = task.get("expected_time", "")
        tips = task.get("tips", "")

        message = base_info

        if instructions:
            message += f"\nüìñ <b>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</b>\n{instructions}\n"

        if expected_time:
            message += f"\n‚è± –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: {expected_time} –º–∏–Ω—É—Ç\n"

        if tips:
            message += f"\nüí° <b>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b>\n{tips}\n"

        return message
